
					
/*! Polyfills */
if(!Date.now){Date.now=function now(){return new Date().getTime()}}if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host;

					
/*!
 * Platform Feature Detection
 * @author Andi Dittrich
 * @version 3.0
 * @requires MooTools.Core/1.5.0
 * @license MIT Style X11 License
 * @url https://github.com/AndiDittrich/MooTools.PlatformFeatures
 */
}(function(){var a=(function(){var b="ClientPlatformDetectionTestCookie"+String.uniqueID();
Cookie.write(b,b);if(Cookie.read(b)==b){Cookie.dispose(b);return true}else{return false}});window.addEvent("domready",function(){var b=document.getElement("html");var d=(function(f,e){b.addClass(f?e:"no-"+e)});b.removeClass("no-js").addClass("js");d(a(),"cookies");d((typeof(Storage)!=="undefined"),"localstorage");if(!Cookie.read("session-init")=="1"){Cookie.write("session-init","1");b.addClass("session-init")
}var c={features:Browser.Features,name:Browser.name,version:Browser.version,platform:Browser.platform,java:navigator.javaEnabled(),language:navigator.language,userAgent:navigator.userAgent,cookiesEnabled:a(),time:(new Date()).getTime(),timezoneOffset:(new Date()).getTimezoneOffset()};window.Platform={storeItem:function(e,f){var g=JSON.encode({time:Date.now(),payload:f});if(typeof(Storage)!=="undefined"){localStorage.setItem(e,g)
}},retrieveItem:function(f){if(typeof(Storage)!=="undefined"){var e=localStorage.getItem(f);e=(e?JSON.decode(e):null);return(e?e.payload:null)}else{return null}},getFeatures:function(){return c}}})}());

					
/*! Jugend forscht - Online Anmeldung 
 * 
 * @author Andi Dittrich
 * @version 3.0 
 * @client Stiftung Jugend forscht e. V. 
 * @requires [MooTools.Core, MooTools.More, Meio.Autocomplete]
 */
var Jufo={OnlineAnmeldung:{},Projektbetreuer:{},FatalError:function(){document.id("JufoAnmeldung").hide();
document.id("FatalErrorMessage").show()},RequestHTMLFragment:function(b,a,c){new Request.HTML({evalScripts:false,url:b,onSuccess:function(f,d,g,e){document.id("JufoAnmeldung").set("html",g);document.getElements(".ma-container").each(function(h){h.dispose()});window.scrollTo(0,0);window.fireEvent("XhrPageLoaded");if(a){a.apply(this)}},onFailure:function(d){Jufo.FatalError()}}).post((c||{}))}};(function(){var a=(function(b){if(history.pushState){history.pushState(null,"",b)
}else{location.hash=b}});a("#no-back");a("#formular");window.addEvent("hashchange",function(){if(location.hash=="#no-back"){a("#formular")}})})();window.jsave=function(){Platform.storeItem("formdata",document.id("JufoAnmeldung").getFormData());return"Daten gespeichert"};window.jload=function(){var a=Platform.retrieveItem("formdata");if(a){delete a["NoRobots[hash]"];delete a["NoRobots[text]"];delete a.Token;
document.id("JufoAnmeldung").setFormData(a);return"Daten wiederhergestellt"}else{return"Keine Daten verfügbar"}};window.addEvent("domready",function(){window.fireEvent("XhrPageLoaded");var b=document.id("ENV-jload");var a=document.id("ENV-jsave");if(b&&a){b.addEvent("click",function(){if(confirm("Sollen die Formulardaten wiederhergestellt werden?")){window.jload()}});a.addEvent("click",function(){if(confirm("Sollen die Formulardaten gespeichert werden?")){window.jsave()
}})}});Jufo.OverlayWindow={show:function(a){var b=document.id("JufoOverlay").show();b.getElement(".action_close").removeEvents().addEvent("click",function(){b.hide()})},hide:function(){document.id("JufoOverlay").hide()}};window.addEvent("XhrPageLoaded",function(){var a=document.getElement("#JufoAnmeldungForm #submitbutton");if(!a){return}a.addEvent("click",function(b){b.stop();this.set("disabled",true);
document.getElement("#JufoAnmeldung .loader").show();var c=document.id("JufoAnmeldungForm").toQueryString();Jufo.RequestHTMLFragment("/Abschicken.html",function(){var d=document.getElement("#JufoAnmeldung .loader");if(d){d.hide()}},c)});Jufo.OnlineAnmeldung.RegistrationForm.init()});Jufo.OnlineAnmeldung.RegistrationForm={version:"3.0",requestUserAccountData:function(d,c,a){var b=new Request.JSON({url:"/Teilnehmer/Anmelden.json",onSuccess:a});
b.post("json="+JSON.encode({username:d,password:c}))},init:function(){var d=JSON.decode(document.id("FormObjectData").get("value"));document.id("FormObjectData").dispose();document.id("PlatformFeatureDetection").set("value",JSON.encode(window.Platform.getFeatures()));var h="change";document.id("ParticipantNumber").addEventAndTrigger(h,function(){switch(this.value){case"1":document.id("participantForm1").show();
document.id("participantForm2").hide();document.id("participantForm3").hide();break;case"2":document.id("participantForm1").show();document.id("participantForm2").show();document.id("participantForm3").hide();break;case"3":document.id("participantForm1").show();document.id("participantForm2").show();document.id("participantForm3").show();break;default:document.id("participantForm1").hide();document.id("participantForm2").hide();
document.id("participantForm3").hide();break}});document.id("SupervisorNumber").addEventAndTrigger(h,function(){switch(this.value){case"1":document.id("supervisorForm1").show();document.id("supervisorForm2").hide();break;case"2":document.id("supervisorForm1").show();document.id("supervisorForm2").show();break;default:document.id("supervisorForm1").hide();document.id("supervisorForm2").hide();break}});
var f=["#participantForm1","#participantForm2","#participantForm3","#SupervisionFacilityContainer"];f.each(function(i){document.getElement(i+" .autocompleteNotFoundCheckbox").addEventAndTrigger("click",function(){var k=document.getElement(i+" .schooldataNew");var l=document.getElement(i+" .schooldataAutocompleteInput");var j=document.getElement(i+" .descriptionText");if(this.get("checked")){k.show();
l.hide();j.hide()}else{k.hide();l.show();j.show()}});new Jufo.Autocompleter(document.getElement(i+" .schooldataAutocompleteInput"),"/Schulen.json",{selectOnTab:false,delay:200,minChars:3,cacheLength:0,cacheType:"own",maxVisibleItems:20,onNoItemToList:function(j){j.field.node.highlight("#a02031")},onPrepareRequest:function(){this.setActionID(document.id("BundeslandID").get("value"))},onSelect:function(j,k){document.getElement(i+" .schooldataAutocompleteID").set("value",k.value)
},onDeselect:function(){document.getElement(i+" .schooldataAutocompleteID").set("value",-1)},onEmpty:function(){document.getElement(i+" .schooldataAutocompleteID").set("value",-1)}})});var g=["#supervisorForm1","#supervisorForm2"];g.each(function(i){document.getElement(i+" .autocompleteNotFoundCheckbox").addEventAndTrigger("click",function(){var j=document.getElement(i+" .supervisorNew");var k=document.getElement(i+" .supervisorAutocompleteInput");
if(this.get("checked")){j.show();k.hide()}else{j.hide();k.show()}});new Jufo.Autocompleter(document.getElement(i+" .supervisorAutocompleteInput"),"/Betreuer.json",{selectOnTab:false,delay:200,minChars:3,cacheLength:0,cacheType:"own",maxVisibleItems:20,onNoItemToList:function(j){j.field.node.highlight("#a02031")},onPrepareRequest:function(){this.setActionID(document.id("BundeslandID").get("value"))},onSelect:function(j,k){document.getElement(i+" .supervisorAutocompleteID").set("value",k.value)
},onDeselect:function(){document.getElement(i+" .supervisorAutocompleteID").set("value",-1)},onEmpty:function(){document.getElement(i+" .supervisorAutocompleteID").set("value",-1)}})});var c=(function(){var j=document.id("KurzfassungText");if(j){var k=j.get("value");var i=(k.match(/\n/g)||[]).length;document.id("KurzfassungTextCounter").set("text",k.length+i)}});c.periodical(400);document.id("SupervisionFacilitySelect").addEventAndTrigger(h,function(){switch(this.value){case"0":case"12":document.id("SupervisionFacilityContainer").hide();
break;default:document.id("SupervisionFacilityContainer").show();break}});var b=["#participantForm1","#participantForm2","#participantForm3"];b.each(function(i){document.getElement(i+" .multipleParticipation").addEventAndTrigger(h,function(){switch(this.value){case"0":document.getElement(i+" .userlogin").hide();break;case"1":document.getElement(i+" .userlogin").show();break;case"2":document.getElement(i+" .userlogin").hide();
break}});document.getElement(i+" .participation").addEventAndTrigger(h,function(){switch(this.value){case"0":document.getElement(i+" .TeilnahmeJahre").hide();break;case"1":document.getElement(i+" .TeilnahmeJahre").show();break;case"2":document.getElement(i+" .TeilnahmeJahre").hide();break}})});b.each(function(i){document.getElement(i+" .userlogin .jsbutton").addEvent("click",function(){var k=document.getElement(i+" .userlogin .Username").get("value");
var j=document.getElement(i+" .userlogin .Password").get("value");Jufo.OnlineAnmeldung.RegistrationForm.requestUserAccountData(k,j,function(l){if(l.valid==true){document.getElement(i+" .userlogin .loginMessage").set("html","Deine vorhandenen Benutzerdaten wurden übernommen. <br />Bitte überprüfe diese und ergänze sie falls nötig.");document.getElement(i+" .autofillVorname").set("value",l.account.Vorname);
document.getElement(i+" .autofillNachname").set("value",l.account.Nachname);document.getElements(i+" .autofillGeschlecht").each(function(n){if(n.get("value")==(l.account.Geschlecht=="m"?"1":"2")){n.set("checked",true)}});document.getElement(i+" .autofillGeschlecht").set("value",(l.account.Geschlecht=="m"?"1":"2"));document.getElement(i+" .autofillPLZ").set("value",l.account.PLZ);document.getElement(i+" .autofillOrt").set("value",l.account.Ort);
document.getElement(i+" .autofillStrasse").set("value",l.account.Strasse);document.getElement(i+" .countrySelect").set("value",l.account.Staat);document.getElement(i+" .countrySelect").fireEvent(h);document.getElement(i+" .autofillEMail1").set("value",l.account.Email);document.getElement(i+" .autofillEMail2").set("value",l.account.Email);document.getElement(i+" .schooldataAutocompleteID").set("value",l.account.SchulID);
if(l.account.Schule){document.getElement(i+" .schooldataAutocompleteInput").set("value",l.account.Schule.searchText)}if(l.account.TelefonPrivat){var m=l.account.TelefonPrivat.match(/\+([0-9]{2,3}) \(([0-9]+)\) ([0-9]+)/);if(m!=null){if(m[1]=="49"){m[2]="0"+m[2]}document.getElement(i+" .areaCode").set("value",m[2]);document.getElement(i+" .telephoneNumber").set("value",m[3])}}if(l.account.Geburtsdatum){var m=l.account.Geburtsdatum.trim().match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})/);
if(m!=null){document.getElement(i+" .birthdateYear").set("value",m[1].toInt());document.getElement(i+" .birthdateMonth").set("value",m[2].toInt());document.getElement(i+" .birthdateDay").set("value",m[3].toInt())}}if(l.account.Klasse&&l.account.Klasse.toInt()>0){document.getElement(i+" .autofillKlasse").set("value",l.account.Klasse.toInt())}}else{document.getElement(i+" .userlogin .loginMessage").set("html",'Diese Benutzerdaten sind uns leider unbekannt. <br />Bitte sende eine E-Mail an <a href="mailto:wettbewerb@jugend-forscht.de" class="mail">wettbewerb(at)jugend-forscht.de</a>')
}})})});document.id("ProjectBaseSelect").addEventAndTrigger(h,function(){if(this.value=="1"){document.id("projectBase").show()}else{document.id("projectBase").hide()}});var e=["#ParticipantContainer1","#ParticipantContainer2","#ParticipantContainer3","#ParticipantSchooldataContainer1","#ParticipantSchooldataContainer2","#ParticipantSchooldataContainer3","#SupervisionFacilityContainer"];e.each(function(i){document.getElement(i+" .countrySelect").addEventAndTrigger(h,function(){var j=0;
var k=this.value;Array.each(d.countryList,function(l){if(l.stateID==k){j=l.countryCode}});document.getElements(i+" .countryCode").set("value",j);if(j=="49"){document.getElements(i+" .countryCode").hide();document.getElements(i+" .countryCodeLabel").hide()}else{document.getElements(i+" .countryCode").show();document.getElements(i+" .countryCodeLabel").show()}})});var a=["#ParticipantSchooldataContainer2","#ParticipantSchooldataContainer3"];
a.each(function(i){document.getElement(i+" .schooldataCopyCheckbox").addEventAndTrigger("click",function(){if(this.get("checked")){document.getElement(i+" .schooldataInputContainer").hide()}else{document.getElement(i+" .schooldataInputContainer").show()}})})}};window.addEvent("XhrPageLoaded",function(){var a=document.id("JufoEMailValidation");if(!a){return}Jufo.OnlineAnmeldung.EMailValidation.init(a.get("data-ph"))
});Jufo.OnlineAnmeldung.EMailValidation={errorCodes:{"-2":"Deine E-Mail-Adresse ist zu lang.","-1":"Die Anmeldung ist bereits abgeschlossen.","0":"Deine E-Mail-Adresse wurde erfolgreich geändert.","1":"Deine E-Mail-Adresse scheint falsch zu sein!","2":"Da ist wohl etwas schiefgelaufen!","3":"Die E-Mail-Adresse des Benutzers wurde bereits bestätigt!",},init:function(d){var e=[];var c=(function(h,g,f){new Request.JSON({url:"/Validierung/NeueEMailAdresse.json",method:"post",onSuccess:f}).post({ph:d,u:h,mail:g})
});var b=(function(g,i){g.getElement(".participant_email").set("text",i.email);g.getElement(".participant_info").set("text",i.info);var f=g.getElement(".participant_status");var h=g.getElement(".participant_emailchange");if(i.valid==1){f.set("text","bestätigt");f.addClass("status_confirmed");f.removeClass("status_pending");h.hide()}else{f.set("text","Warten auf Bestätigung");f.addClass("status_pending");
h.show()}});Array.each([1,2,3],function(f){document.getElement("#JufoEMailValidation .participant_"+f+" .participant_emailchange").addEvent("click",function(){var i=document.id("EMailValidationModalBox");var l=i.getElement(".status_message").set("text","").removeClass("status_success");var j=i.getElement(".userInfo").set("text","");var k=i.getElement(".ajax_loader").hide();var g=i.getElement(".searchbutton").removeEvents();
var h=i.getElement(".email_address_input").set("value","");j.set("text",e[f-1].info);g.addEvent("click",function(){var m=h.get("value");if(m.length>5){k.show();c(f,m,function(n){k.hide();l.set("text",Jufo.OnlineAnmeldung.EMailValidation.errorCodes[n.code+""]);if(n.status=="success"){l.addClass("status_success");Jufo.OverlayWindow.hide.delay(1000)}})}else{l.set("text","Bitte gib eine gültige E-Mail-Adresse ein!")
}});Jufo.OverlayWindow.show("EMailValidationModalBox")})});var a=null;a=new Request.JSON({url:"/Validierung/Status.json",method:"post",delay:5000,limit:10000,initialDelay:10,onSuccess:function(h){if(h.status==2){a.stopTimer();Jufo.RequestHTMLFragment("/Bestaetigung.html",null,{ph:d})}else{e=h.participants;for(var g=1;g<4;g++){var f=document.getElement("#JufoEMailValidation .participant_"+g);if(g<=h.participants.length){f.show();
b(f,h.participants[g-1])}else{f.hide()}}}}});a.startTimer({ph:d})}};(function(b,c){var d=Browser.ie6;var a=new Class({Implements:Options,options:{top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},initialize:function(f,e){if(!d){return}this.setOptions(e);this.element=c(f);var g=this.element.getFirst();if(!(g&&g.hasClass("bgiframe"))){this.element.grab(document.createElement(this.render()),"top")
}},toPx:function(e){return isFinite(e)?e+"px":e},render:function(){var e=this.options;return['<iframe class="bgiframe" frameborder="0" tabindex="-1" src="',e.src,'" ','style="display:block;position:absolute;z-index:-1;',(e.opacity!==false?"filter:alpha(opacity='0');":""),"top:",(e.top==="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":this.toPx(e.top)),";","left:",(e.left==="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":this.toPx(e.left)),";","width:",(e.width==="auto"?"expression(this.parentNode.offsetWidth+'px')":this.toPx(e.width)),";","height:",(e.height==="auto"?"expression(this.parentNode.offsetHeight+'px')":this.toPx(e.height)),";",'"/>'].join("")
}});Element.implement("bgiframe",function(e){if(d){new a(this,e)}return this})})(this,document.id||this.$);(function(b,c){var a=Browser;Object.append(Element.NativeEvents,{paste:2,input:2});Element.Events.paste={base:(a.opera||(a.firefox&&a.version<3))?"input":"paste",condition:function(d){this.fireEvent("paste",d,1);return false}};Element.Events.keyrepeat={base:(a.firefox||a.opera)?"keypress":"keydown",condition:Function.from(true)};
b.Meio=b.Meio||{}}(this,document.id||this.$));Meio.Widget=new Class({initialize:function(){this.elements={}},addElement:function(a,b){this.elements[a]=b},addEventToElement:function(b,a,c){this.elements[b].addEvent(a,c.bind(this))},addEventsToElement:function(b,c){for(var a in c){this.addEventToElement(b,a,c[a])}},attach:function(){for(var a in this.elements){this.elements[a].attach()}},detach:function(){for(var a in this.elements){this.elements[a].detach()
}},destroy:function(){for(var a in this.elements){if(this.elements[a]){this.elements[a].destroy()}}}});(function(a,b){a.Meio.Element=new Class({Implements:[Events],initialize:function(c){this.setNode(c);this.createBoundEvents();this.attach()},setNode:function(c){this.node=c?b(c)||$$(c)[0]:this.render()},createBoundEvents:function(){this.bound={};this.boundEvents.each(function(c){this.bound[c]=function(d){this.fireEvent("before"+c.capitalize(),d);
if(this[c]){this[c](d)}this.fireEvent(c,d);return true}.bind(this)},this)},attach:function(){for(var c in this.bound){this.node.addEvent(c,this.bound[c])}},detach:function(){for(var c in this.bound){this.node.removeEvent(c,this.bound[c])}},addClass:function(c){this.node.addClass(this.options.classes[c])},removeClass:function(c){this.node.removeClass(this.options.classes[c])},toElement:function(){return this.node
},render:function(){}})}(this,document.id||this.$));(function(a,b){a.Meio.Element.Field=new Class({Extends:a.Meio.Element,Implements:[Options],options:{classes:{loading:"ma-loading",selected:"ma-selected"}},initialize:function(d,c){this.keyPressControl={};this.boundEvents=["paste","focus","blur","click","keyup","keyrepeat"];if(Browser.ie6){this.boundEvents.push("keypress")}this.setOptions(c);this.parent(d);
b(a).addEvent("unload",function(){if(this.node){b(this.node).set("autocomplete","on")}}.bind(this))},setNode:function(c){this.parent(c);this.node.set("autocomplete","off")},keyrepeat:function(c){clearInterval(this.keyrepeatTimer);this.keyrepeatTimer=this._keyrepeat.delay(1,this,c)},_keyrepeat:function(c){this.fireEvent("delayedKeyrepeat",c)},destroy:function(){this.detach();this.node.removeAttribute("autocomplete")
},keypress:function(c){if(c.key==="enter"){this.bound.keyrepeat(c)}}})}(this,document.id||this.$));(function(a,b){a.Meio.Element.List=new Class({Extends:a.Meio.Element,Implements:[Options],options:{width:"field",container:"body",classes:{container:"ma-container",hover:"ma-hover",odd:"ma-odd",even:"ma-even"}},initialize:function(c){this.boundEvents=["mousedown","mouseover"];this.setOptions(c);this.parent();
this.focusedItem=null},applyMaxHeight:function(f){var c=this.list.childNodes;var e=c[f-1]||(c.length?c[c.length-1]:null);if(!e){return}e=b(e);for(var d=2;d--;){this.node.setStyle("height",e.getCoordinates(this.list).bottom)}},mouseover:function(d){var c=this.getItemFromEvent(d),f=this.options.classes.hover;if(!c){return true}if(this.focusedItem){this.focusedItem.removeClass(f)}c.addClass(f);this.focusedItem=c;
this.fireEvent("focusItem",[this.focusedItem])},mousedown:function(c){c.preventDefault();this.shouldNotBlur=true;if(!(this.focusedItem=this.getItemFromEvent(c))){c.dontHide=true;return true}this.focusedItem.removeClass(this.options.classes.hover)},focusItem:function(d){var e=this.options.classes.hover,c;if(this.focusedItem){if((c=this.focusedItem[d=="up"?"getPrevious":"getNext"]())){this.focusedItem.removeClass(e);
c.addClass(e);this.focusedItem=c;this.scrollFocusedItem(d)}}else{if((c=this.list.getFirst())){c.addClass(e);this.focusedItem=c}}},scrollFocusedItem:function(f){var c=this.focusedItem.getCoordinates(this.list),e=this.node.scrollTop;if(f=="down"){var g=c.bottom-this.node.getStyle("height").toInt();if((g-e)>0){this.node.scrollTop=g}}else{var d=c.top;if(e&&e>d){this.node.scrollTop=d}}},getItemFromEvent:function(d){var c=d.target;
while(c&&c.tagName.toLowerCase()!="li"){if(c===this.node){return null}c=c.parentNode}return b(c)},render:function(){var c=new Element("div",{"class":this.options.classes.container});if(c.bgiframe){c.bgiframe({top:0,left:0})}this.list=new Element("ul").inject(c);$$(this.options.container)[0].grab(c);return c},positionNextTo:function(c){var d=this.options.width,e=this.node;var f=c.getCoordinates();e.setStyle("width",d=="field"?c.getWidth().toInt()-e.getStyle("border-left-width").toInt()-e.getStyle("border-right-width").toInt():d);
e.setPosition({x:f.left,y:f.bottom})},show:function(){this.node.scrollTop=0;this.node.setStyle("visibility","visible");this.showing=true},hide:function(){this.showing=false;this.node.setStyle("visibility","hidden")}})}(this,document.id||this.$));(function(d,e){var a=d.Meio;var b={9:1,16:1,17:1,18:1,224:1,91:1,37:1,38:1,39:1,40:1};var c=function(f){return f.replace(/"/g,"&quot;").replace(/'/g,"&#39;")
};a.Autocomplete=new Class({Extends:a.Widget,Implements:[Options,Events],options:{delay:200,minChars:0,cacheLength:20,selectOnTab:true,autoFocus:false,maxVisibleItems:10,cacheType:"shared",filter:{},fieldOptions:{},listOptions:{},requestOptions:{},urlOptions:{}},initialize:function(f,i,g,h){this.parent();this.setOptions(g);this.active=0;this.filters=a.Autocomplete.Filter.get(this.options.filter);this.addElement("list",h||new a.Element.List(this.options.listOptions));
this.addListEvents();this.addElement("field",new a.Element.Field(f,this.options.fieldOptions));this.addFieldEvents();this.addSelectEvents();this.attach();this.initCache();this.initData(i)},addFieldEvents:function(){this.addEventsToElement("field",{beforeKeyrepeat:function(h){this.active=1;var f=h.key,g=this.elements.list;if(f=="up"||f=="down"||(f=="enter"&&g.showing)){h.preventDefault()}},delayedKeyrepeat:function(h){var f=h.key,g=this.elements.field;
g.keyPressControl[f]=true;switch(f){case"up":case"down":this.focusItem(f);break;case"enter":this.setInputValue();break;case"tab":if(this.options.selectOnTab){this.setInputValue()}g.keyPressControl[f]=false;break;case"esc":this.elements.list.hide();break;default:this.setupList()}this.oldInputedText=g.node.get("value")},keyup:function(g){var f=this.elements.field;if(!b[g.code]){if(!f.keyPressControl[g.key]){this.setupList()
}f.keyPressControl[g.key]=false}},focus:function(){this.active=1;var f=this.elements.list;f.focusedItem=null;f.positionNextTo(this.elements.field.node)},click:function(){if(++this.active>2&&!this.elements.list.showing){this.forceSetupList()}},blur:function(g){this.active=0;var f=this.elements.list;if(f.shouldNotBlur){this.elements.field.node.setCaretPosition("end");f.shouldNotBlur=false;if(f.focusedItem){f.hide()
}}else{f.hide()}},paste:function(){return this.setupList()}})},addListEvents:function(){this.addEventsToElement("list",{mousedown:function(f){if(this.active&&!f.dontHide){this.setInputValue()}}})},update:function(){var m=this.data,p=this.elements.list;var r=m.getKey(),j=this.cache.get(r),o;if(j){o=j.html;this.itemsData=j.data}else{m=m.get();var t=[],s=[],k=p.options.classes,u=this.inputedText;var g=this.filters.filter,f=this.filters.formatMatch,q=this.filters.formatItem;
for(var v,l=0,h=0;(v=m[l++]);){if(g.call(this,u,v)){t.push('<li title="',c(f.call(this,u,v)),'" data-index="',h,'" class="',(h%2?k.even:k.odd),'">',q.call(this,u,v,h),"</li>");s.push(v);h++}}o=t.join("");this.cache.set(r,{html:o,data:s});this.itemsData=s}p.focusedItem=null;this.fireEvent("deselect",[this.elements]);p.list.set("html",o);if(this.options.maxVisibleItems){p.applyMaxHeight(this.options.maxVisibleItems)
}},setupList:function(){this.inputedText=this.elements.field.node.get("value");if(this.inputedText!==this.oldInputedText){this.forceSetupList(this.inputedText)}else{this.elements.list.hide()}return true},forceSetupList:function(f){f=f||this.elements.field.node.get("value");if(f.length>=this.options.minChars){clearInterval(this.prepareTimer);this.prepareTimer=this.data.prepare.delay(this.options.delay,this.data,f)
}},dataReady:function(){this.update();if(this.onUpdate){this.onUpdate();this.onUpdate=null}var f=this.elements.list;if(f.list.get("html")){this.fireEvent("itemToList",[this.elements]);if(this.options.autoFocus&&f.list.getChildren().length===1){this.focusItem()}if(this.active){f.show()}else{if(this.options.autoFocus&&f.list.getChildren().length===1){this.setInputValue()}}}else{this.fireEvent("noItemToList",[this.elements]);
f.hide()}},setInputValue:function(){var g=this.elements.list;if(g.focusedItem){var h=g.focusedItem.get("title");this.elements.field.node.set("value",h);var f=g.focusedItem.get("data-index");this.fireEvent("select",[this.elements,this.itemsData[f],h,f])}g.hide()},focusItem:function(g){var f=this.elements.list;if(f.showing){f.focusItem(g)}else{this.forceSetupList();this.onUpdate=function(){f.focusItem(g)
}}},addSelectEvents:function(){this.addEvents({select:function(f){f.field.addClass("selected")},deselect:function(f){f.field.removeClass("selected")}})},initData:function(f){this.data=(typeOf(f)=="string")?new a.Autocomplete.Data.Request(f,this.cache,this.elements.field,this.options.requestOptions,this.options.urlOptions):(typeOf(f)=="function")?new a.Autocomplete.Data.Source(f,this.cache,this.elements.field):new a.Autocomplete.Data(f,this.cache);
this.data.addEvent("ready",this.dataReady.bind(this))},initCache:function(){var f=this.options.cacheLength;if(this.options.cacheType=="shared"){this.cache=a.Autocomplete.Cache.instance;this.cache.setMaxLength(f)}else{if(this.options.cacheType=="own"){this.cache=new a.Autocomplete.Cache(f)}else{this.cache=new a.Autocomplete.FakeCache()}}},refreshCache:function(f){this.cache.refresh();this.cache.setMaxLength(f||this.options.cacheLength)
},refreshAll:function(g,f){this.refreshCache(g);this.data.refreshKey(f)}})}(this,document.id||this.$));(function(a,b){a.Meio.Autocomplete.Select=new Class({Extends:a.Meio.Autocomplete,options:{syncName:"id",valueField:null,valueFilter:function(c){return c.id}},initialize:function(c,f,d,e){this.parent(c,f,d,e);this.valueField=b(this.options.valueField);if(!this.valueField){return}this.syncWithValueField(f)
},syncWithValueField:function(d){var c=this.getValueFromValueField();if(c&&this.options.syncName){this.addParameter(d);this.addDataReadyEvent(c);this.data.prepare(this.elements.field.node.get("value"))}else{this.addValueFieldEvents()}},addValueFieldEvents:function(){this.addEvents({select:function(d,c){this.valueField.set("value",this.options.valueFilter.call(this,c))},deselect:function(c){this.valueField.set("value","")
}})},addParameter:function(c){this.parameter={name:this.options.syncName,value:function(){return this.valueField.value}.bind(this)};if(this.data.url){this.data.url.addParameter(this.parameter)}},addDataReadyEvent:function(e){var d=this;var c=function(){d.addValueFieldEvents();var f=this.get();for(var g=f.length;g--;){if(d.options.valueFilter.call(d,f[g])==e){var h=d.filters.formatMatch.call(d,"",f[g],0);
d.elements.field.node.set("value",h);d.fireEvent("select",[d.elements,f[g],h,g]);break}}if(this.url){this.url.removeParameter(d.parameter)}this.removeEvent("ready",c)};this.data.addEvent("ready",c)},getValueFromValueField:function(){return this.valueField.get("value")}})}(this,document.id||this.$));(function(a,b){Meio.Autocomplete.Select.One=new Class({Extends:Meio.Autocomplete.Select,options:{filter:{path:"text"}},initialize:function(c,d,e){this.select=b(c);
this.replaceSelect();this.parent(this.field,this.createDataArray(),Object.merge(d||{},{valueField:this.select,valueFilter:function(f){return f.value}}),e)},replaceSelect:function(){var c=this.select.getSelected()[0];this.field=new Element("input",{type:"text"});var d=c.get("value");if(d||d===0){this.field.set("value",c.get("html"))}this.select.setStyle("display","none");this.field.inject(this.select,"after")
},createDataArray:function(){var d=this.select.options,f=[];for(var e=0,c,g;c=d[e++];){g=c.value;if(g||g===0){f.push({value:g,text:c.innerHTML})}}return f},addValueFieldEvents:function(){this.addEvents({select:function(f,e,g,c){var d=this.valueField.getElement('option[value="'+this.options.valueFilter.call(this,e)+'"]');if(d){d.selected=true}},deselect:function(d){var c=this.valueField.getSelected()[0];
if(c){c.selected=false}}})},getValueFromValueField:function(){return this.valueField.getSelected()[0].get("value")}})}(this,document.id||this.$));Meio.Autocomplete.Filter={filters:{},get:function(a){var b=a.type,d=(a.path||"").split(".");var c=(b&&this.filters[b])?this.filters[b](this,d):a;return Object.merge(this.defaults(d),c)},define:function(b,a){this.filters[b]=a},defaults:function(b){var a=this;
return{filter:function(d,c){return d?a._getValueFromKeys(c,b).test(new RegExp(d.escapeRegExp(),"i")):true},formatMatch:function(d,c){return a._getValueFromKeys(c,b)},formatItem:function(e,d,c){return e?a._getValueFromKeys(d,b).replace(new RegExp("("+e.escapeRegExp()+")","gi"),"<strong>$1</strong>"):a._getValueFromKeys(d,b)}}},_getValueFromKeys:function(e,c){var b,d=e;for(var a=0;(b=c[a++]);){d=d[b]
}return d}};Meio.Autocomplete.Filter.define("contains",function(a,b){return{}});Meio.Autocomplete.Filter.define("startswith",function(a,b){return{filter:function(d,c){return d?a._getValueFromKeys(c,b).test(new RegExp("^"+d.escapeRegExp(),"i")):true}}});Meio.Autocomplete.Data=new Class({Implements:[Options,Events],initialize:function(b,a){this.data=b;this._cache=a;this.dataString=JSON.encode(this.data)
},get:function(){return this.data},getKey:function(){return this.cachedKey},prepare:function(a){this.cachedKey=this.dataString+(a||"");this.fireEvent("ready")},cache:function(a,b){this._cache.set(a,b)},refreshKey:function(){}});Meio.Autocomplete.Data.Source=new Class({Extends:Meio.Autocomplete.Data,initialize:function(c,a,b){this.source=c;this._cache=a;this.element=b},prepare:function(a){this.element.addClass("loading");
this.source(a,this.done.bind(this))},done:function(a){this.data=a;this.element.removeClass("loading");this.fireEvent("ready")}});Meio.Autocomplete.Data.Request=new Class({Extends:Meio.Autocomplete.Data,options:{noCache:true,formatResponse:function(a){return a},link:"cancel"},initialize:function(d,b,e,c,a){this.setOptions(c);this.rawUrl=d;this._cache=b;this.element=e;this.urlOptions=a;this.refreshKey();
this.createRequest()},prepare:function(a){this.cachedKey=this.url.evaluate(a);if(this._cache.has(this.cachedKey)){this.fireEvent("ready")}else{this.request.send({url:this.cachedKey})}},createRequest:function(){var a=this;this.request=new Request.JSON(this.options);this.request.addEvents({request:function(){a.element.addClass("loading")},complete:function(){a.element.removeClass("loading")},success:function(b){a.data=a.options.formatResponse(b);
a.fireEvent("ready")}})},refreshKey:function(a){a=Object.merge(this.urlOptions,{url:this.rawUrl},a||{});this.url=new Meio.Autocomplete.Data.Request.URL(a.url,a)}});Meio.Autocomplete.Data.Request.URL=new Class({Implements:[Options],options:{queryVarName:"q",extraParams:null,max:20},initialize:function(b,a){this.setOptions(a);this.rawUrl=b;this.url=b;this.url+=this.url.contains("?")?"&":"?";this.dynamicExtraParams=[];
var d=Array.from(this.options.extraParams);for(var c=d.length;c--;){this.addParameter(d[c])}if(this.options.max){this.addParameter("limit="+this.options.max)}},evaluate:function(d){d=d||"";var c=this.dynamicExtraParams,a=[];a.push(this.options.queryVarName+"="+encodeURIComponent(d));for(var b=c.length;b--;){a.push(encodeURIComponent(c[b].name)+"="+encodeURIComponent(Function.from(c[b].value)()))}return this.url+a.join("&")
},addParameter:function(a){if(a.nodeType==1||typeOf(a.value)=="function"){this.dynamicExtraParams.push(a)}else{this.url+=((typeOf(a)=="string")?a:encodeURIComponent(a.name)+"="+encodeURIComponent(a.value))+"&"}},removeParameter:function(a){this.dynamicExtraParams.erase(a)}});(function(a){a.Meio.Autocomplete=a.Meio.Autocomplete||{};var b=a.Meio.Autocomplete.Cache=new Class({initialize:function(c){this.refresh();
this.setMaxLength(c)},set:function(c,d){if(!this.cache[c]){if(this.getLength()>=this.maxLength){var e=this.pos.shift();this.cache[e]=null;delete this.cache[e]}this.cache[c]=d;this.pos.push(c)}return this},get:function(c){return this.cache[c||""]||null},has:function(c){return !!this.get(c)},getLength:function(){return this.pos.length},refresh:function(){this.cache={};this.pos=[]},setMaxLength:function(c){this.maxLength=Math.max(c,1)
}});a.Meio.Autocomplete.FakeCache=new Class({Extends:b,get:function(){return null},set:function(){return this}});a.Meio.Autocomplete.Cache.instance=new Meio.Autocomplete.Cache()}(this));Jufo.Autocompleter=new Class({Extends:Meio.Autocomplete,initialize:function(a,d,b,c){this.parent(a,d,b,c);this.addEventsToElement("field",{blur:function(f){if(document.id(a).get("value").trim().length==0){this.fireEvent("empty")
}}.bind(this)})},initData:function(a){this.data=new Jufo.Autocompleter.Request(a,this.cache,this.elements.field,this.options.requestOptions,this.options.urlOptions);this.data.addEvent("ready",this.dataReady.bind(this));this.data.addEvent("prepareRequest",function(){this.fireEvent("prepareRequest")}.bind(this))},setActionID:function(a){this.data.setActionID(a)},update:function(){var f=this.data,e=this.elements.list;
var g=f.getKey(),c=this.cache.get(g),b;f=f.get();var d=[],h=[],a=e.options.classes;if(this.data.get().length>19){d.push('<li class="ma-limit-message"></li>')}Array.each(this.data.get(),function(j,i){d.push('<li title="',j.text.replace(/"/g,"&quot;").replace(/'/g,"&#39;"),'" data-index="',i,'" class="',(i%2?a.even:a.odd),'">',this.highlightQueryElements(j.text,this.inputedText||""),"</li>");h.push(j)
}.bind(this));b=d.join("");this.cache.set(g,{html:b,data:h});this.itemsData=h;e.focusedItem=null;this.fireEvent("deselect",[this.elements]);e.list.set("html",b)},highlightQueryElements:function(c,b){b=b.replace(/\s+/gi," ").trim();var a=b.split(" ");Array.each(a,function(d){c=c.replace(new RegExp(d,"gi"),"["+d+"]")});c=c.replace(/\[/gi,"<strong>");c=c.replace(/\]/gi,"</strong>");return c}});Jufo.Autocompleter.Request=new Class({Extends:Meio.Autocomplete.Data,url:"",actionID:0,request:null,initialize:function(d,b,e,c,a){this.rawUrl=d;
this._cache=b;this.element=e;this.refreshKey();this.createRequest()},prepare:function(a){this.fireEvent("prepareRequest");this.request.send({method:"post",data:"query="+a.trim(),url:this.rawUrl})},createRequest:function(){var a=this;this.request=new Request.JSON(this.options);this.request.addEvents({request:function(){a.element.addClass("loading")},complete:function(){a.element.removeClass("loading")
},success:function(b){a.data=b.data;a.fireEvent("ready")}})},refreshKey:function(a){},setActionID:function(a){this.actionID=a}});